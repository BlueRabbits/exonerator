<?xml version="1.0"?>

<!DOCTYPE project [
       <!ENTITY base SYSTEM "src/build/java/base.xml">
]>

<project default="usage" name="exonerator" basedir=".">

  <property name="javadoc-title" value="ExoneraTor API Documentation"/>
  <property name="implementation-title" value="ExoneraTor" />
  <property name="release.version" value="1.0.0-dev" />
  <property name="metricslibversion" value="2.1.1" />
  <property name="warfile"
            value="exonerator-${release.version}.war"/>

  <property name="name" value="exonerator"/>

  <property name="project-main-class"
            value="org.torproject.exonerator.ExoneraTorDatabaseImporter" />
  <property name="additional2sign" value="${warfile}" />
  <property name="tardepends" value="war" />

  <!-- The coverage needs to be improved! -->
  <target name="coverage-check">
    <cobertura-check totallinerate="9" totalbranchrate="7" >
      <!-- example regexes
      <regex pattern="org.torproject.abc.xyz.*"
             branchrate="87" linerate="73"/>
      -->
    </cobertura-check>
  </target>

  <patternset id="common" >
    <include name="commons-codec-1.10.jar"/>
    <include name="commons-lang3-3.5.jar"/>
    <include name="gson-2.4.jar" />
    <include name="postgresql-9.4.1212.jar"/>
    <include name="slf4j-api-1.7.22.jar"/>
  </patternset>

  <patternset id="library" >
    <patternset refid="common" />
    <include name="metrics-lib-${metricslibversion}.jar"/>
    <include name="commons-compress-1.13.jar"/>
    <include name="servlet-api-3.0.jar"/>
    <include name="logback-core-1.1.9.jar" />
    <include name="logback-classic-1.1.9.jar" />
    <include name="xz-1.6.jar"/>
  </patternset>

  <patternset id="web" >
    <patternset refid="common" />
  </patternset>

  <patternset id="runtime" >
    <patternset refid="library" />
  </patternset>

  <!-- Create a .war file for deployment. -->
  <target name="war"
          depends="compile">
    <war destfile="${dist}/${warfile}"
         webxml="${resources}/web.xml">
      <zipfileset dir="${resources}/web"
                  prefix=""
                  includes="css/* images/*"/>
      <zipfileset dir="${resources}/web/jsps"
                  prefix="WEB-INF"
                  includes="*.jsp"/>
      <lib dir="${libs}">
        <patternset refid="web" />
      </lib>
      <classes dir="${classes}"/>
      <zipfileset dir="${resources}"
                  prefix="WEB-INF/classes"
                  includes="*.properties" />
      <metainf dir="${resources}"
               includes="context.xml"/>
    </war>
  </target>


  <!-- The following line adds the common targets and properties
       for Metrics' Java Projects.
  -->
  &base;

</project>

